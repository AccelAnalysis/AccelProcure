<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Profile - AccelRFx</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .enrichment-badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
        }
        .enrichment-pending {
            @apply bg-yellow-100 text-yellow-800
        }
        .enrichment-complete {
            @apply bg-green-100 text-green-800
        }
        .enrichment-error {
            @apply bg-red-100 text-red-800
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-900">Company Profile</h1>
                <button @click="saveProfile" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Save Changes
                </button>
            </div>
        </header>

        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
                <!-- Loading State -->
                <div v-if="loading" class="text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                    <p class="mt-4 text-gray-600">Loading your profile...</p>
                </div>

                <!-- Profile Form -->
                <div v-else class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <!-- Company Information -->
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Company Information</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Basic details about your company.</p>
                    </div>
                    
                    <div class="px-4 py-5 sm:p-6">
                        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                            <div class="sm:col-span-3">
                                <label for="company-name" class="block text-sm font-medium text-gray-700">Company Name</label>
                                <input type="text" v-model="profile.companyName" id="company-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            </div>

                            <div class="sm:col-span-3">
                                <label for="duns" class="block text-sm font-medium text-gray-700">DUNS Number</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="text" v-model="profile.duns" id="duns" class="flex-1 min-w-0 block w-full px-3 py-2 rounded-md border border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="e.g. 123456789">
                                    <button @click="enrichFromDuns" class="ml-3 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        Enrich
                                    </button>
                                </div>
                            </div>

                            <div class="sm:col-span-3">
                                <label for="naics" class="block text-sm font-medium text-gray-700">NAICS Codes</label>
                                <input type="text" v-model="profile.naics" id="naics" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="e.g. 541511, 541512">
                            </div>

                            <div class="sm:col-span-3">
                                <label for="cage" class="block text-sm font-medium text-gray-700">CAGE Code</label>
                                <input type="text" v-model="profile.cage" id="cage" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            </div>

                            <div class="sm:col-span-6">
                                <label for="address" class="block text-sm font-medium text-gray-700">Business Address</label>
                                <input type="text" v-model="profile.address" id="address" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            </div>

                            <div class="sm:col-span-2">
                                <label for="city" class="block text-sm font-medium text-gray-700">City</label>
                                <input type="text" v-model="profile.city" id="city" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            </div>

                            <div class="sm:col-span-2">
                                <label for="state" class="block text-sm font-medium text-gray-700">State/Region</label>
                                <input type="text" v-model="profile.state" id="state" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            </div>

                            <div class="sm:col-span-2">
                                <label for="zip" class="block text-sm font-medium text-gray-700">ZIP/Postal Code</label>
                                <input type="text" v-model="profile.zip" id="zip" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            </div>
                        </div>
                    </div>

                    <!-- Company Capabilities -->
                    <div class="px-4 py-5 sm:px-6 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg leading-6 font-medium text-gray-900">Company Capabilities</h3>
                                <p class="mt-1 text-sm text-gray-500">Describe what your company specializes in.</p>
                            </div>
                            <button @click="suggestCapabilities" type="button" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                <i class="mdi mdi-lightbulb-outline mr-1.5"></i> AI Suggest
                            </button>
                        </div>
                    </div>
                    
                    <div class="px-4 pb-5 sm:px-6">
                        <div class="space-y-4">
                            <div>
                                <label for="capabilities" class="block text-sm font-medium text-gray-700">Capabilities</label>
                                <div class="mt-1">
                                    <textarea id="capabilities" v-model="profile.capabilities" rows="4" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                                </div>
                                <p class="mt-2 text-sm text-gray-500">Briefly describe your company's core capabilities and expertise.</p>
                            </div>

                            <div>
                                <label for="past-performance" class="block text-sm font-medium text-gray-700">Past Performance</label>
                                <div class="mt-1">
                                    <textarea id="past-performance" v-model="profile.pastPerformance" rows="4" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                                </div>
                                <p class="mt-2 text-sm text-gray-500">Highlight relevant past performance, contracts, or projects.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Enrichment Status -->
                    <div class="px-4 py-5 sm:px-6 border-t border-gray-200 bg-gray-50">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Data Enrichment</h3>
                        <p class="mt-1 text-sm text-gray-500">We can automatically enrich your profile with additional data from trusted sources.</p>
                    </div>
                    
                    <div class="px-4 py-5 sm:p-6 bg-gray-50">
                        <div class="space-y-4">
                            <div v-for="(status, source) in enrichmentStatus" :key="source" class="flex items-center justify-between p-3 bg-white rounded-lg shadow">
                                <div class="flex items-center">
                                    <div :class="{
                                        'bg-blue-100 text-blue-800': status === 'pending',
                                        'bg-green-100 text-green-800': status === 'complete',
                                        'bg-red-100 text-red-800': status === 'error',
                                        'bg-gray-100 text-gray-800': status === 'not_started'
                                    }" class="p-2 rounded-full">
                                        <i v-if="status === 'pending'" class="mdi mdi-loading animate-spin"></i>
                                        <i v-else-if="status === 'complete'" class="mdi mdi-check"></i>
                                        <i v-else-if="status === 'error'" class="mdi mdi-alert-circle"></i>
                                        <i v-else class="mdi mdi-database"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="text-sm font-medium text-gray-900">{{ formatSourceName(source) }}</h4>
                                        <p class="text-xs text-gray-500">
                                            {{ getStatusMessage(source, status) }}
                                        </p>
                                    </div>
                                </div>
                                <button v-if="status === 'not_started' || status === 'error'" @click="enrichFromSource(source)" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    {{ status === 'error' ? 'Retry' : 'Enrich' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-8">
            <div class="max-w-7xl mx-auto py-6 px-4 overflow-hidden sm:px-6 lg:px-8">
                <p class="text-center text-sm text-gray-500">
                    &copy; 2025 AccelRFx. All rights reserved.
                </p>
            </div>
        </footer>
    </div>

    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3.2.31/dist/vue.global.prod.js"></script>
    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const loading = ref(true);
                const profile = ref({
                    companyName: '',
                    duns: '',
                    naics: '',
                    cage: '',
                    address: '',
                    city: '',
                    state: '',
                    zip: '',
                    capabilities: '',
                    pastPerformance: ''
                });

                const enrichmentStatus = ref({
                    sam: 'not_started',
                    usaspending: 'not_started',
                    scc: 'not_started',
                    dnb: 'not_started'
                });

                // Load profile data
                const loadProfile = async () => {
                    try {
                        loading.value = true;
                        // This would be replaced with actual API call
                        // const response = await fetch('/api/profiles/me');
                        // const data = await response.json();
                        // profile.value = data;
                        
                        // Mock data for development
                        setTimeout(() => {
                            profile.value = {
                                companyName: 'Acme Corporation',
                                duns: '123456789',
                                naics: '541511, 541512',
                                cage: 'ABC12',
                                address: '123 Business Ave',
                                city: 'Washington',
                                state: 'DC',
                                zip: '20001',
                                capabilities: 'IT consulting, software development, cloud solutions',
                                pastPerformance: 'Provided IT services to multiple federal agencies including GSA and DoD.'
                            };
                            loading.value = false;
                        }, 1000);
                    } catch (error) {
                        console.error('Failed to load profile:', error);
                        loading.value = false;
                    }
                };

                // Save profile data
                const saveProfile = async () => {
                    try {
                        loading.value = true;
                        // This would be replaced with actual API call
                        // const response = await fetch('/api/profiles/me', {
                        //     method: 'PUT',
                        //     headers: { 'Content-Type': 'application/json' },
                        //     body: JSON.stringify(profile.value)
                        // });
                        // const data = await response.json();
                        
                        // Mock success
                        setTimeout(() => {
                            alert('Profile saved successfully!');
                            loading.value = false;
                        }, 1000);
                    } catch (error) {
                        console.error('Failed to save profile:', error);
                        alert('Failed to save profile. Please try again.');
                        loading.value = false;
                    }
                };

                // Enrich profile from DUNS
                const enrichFromDuns = async () => {
                    if (!profile.value.duns) {
                        alert('Please enter a DUNS number');
                        return;
                    }

                    try {
                        enrichmentStatus.value.dnb = 'pending';
                        // This would be replaced with actual API call
                        // const response = await fetch(`/api/profiles/enrich/dnb?duns=${profile.value.duns}`);
                        // const data = await response.json();
                        
                        // Mock success
                        setTimeout(() => {
                            // Update profile with enriched data
                            // profile.value = { ...profile.value, ...data };
                            enrichmentStatus.value.dnb = 'complete';
                            alert('Company data enriched successfully!');
                        }, 1500);
                    } catch (error) {
                        console.error('Enrichment failed:', error);
                        enrichmentStatus.value.dnb = 'error';
                        alert('Failed to enrich company data. Please check your DUNS number and try again.');
                    }
                };

                // Enrich from specific source
                const enrichFromSource = async (source) => {
                    try {
                        enrichmentStatus.value[source] = 'pending';
                        // This would be replaced with actual API call
                        // const response = await fetch(`/api/profiles/enrich/${source}`);
                        // const data = await response.json();
                        
                        // Mock success
                        setTimeout(() => {
                            // Update profile with enriched data
                            // profile.value = { ...profile.value, ...data };
                            enrichmentStatus.value[source] = 'complete';
                        }, 1500);
                    } catch (error) {
                        console.error(`Enrichment from ${source} failed:`, error);
                        enrichmentStatus.value[source] = 'error';
                    }
                };

                // Suggest capabilities using AI
                const suggestCapabilities = async () => {
                    if (!profile.value.companyName || !profile.value.naics) {
                        alert('Please provide your company name and NAICS codes first');
                        return;
                    }

                    try {
                        // This would be replaced with actual API call to AI service
                        // const response = await fetch('/api/ai/suggest-capabilities', {
                        //     method: 'POST',
                        //     headers: { 'Content-Type': 'application/json' },
                        //     body: JSON.stringify({
                        //         companyName: profile.value.companyName,
                        //         naics: profile.value.naics
                        //     })
                        // });
                        // const { suggestions } = await response.json();
                        
                        // Mock suggestions
                        setTimeout(() => {
                            const mockSuggestions = [
                                'Cloud migration and modernization services',
                                'Cybersecurity and compliance consulting',
                                'Custom software development for federal agencies',
                                'DevOps and CI/CD pipeline implementation',
                                'Data analytics and visualization'
                            ];
                            
                            if (confirm('Replace your current capabilities with AI suggestions?')) {
                                profile.value.capabilities = mockSuggestions.join(', ');
                            } else {
                                // Append to existing capabilities
                                profile.value.capabilities = profile.value.capabilities 
                                    ? `${profile.value.capabilities}, ${mockSuggestions.join(', ')}`
                                    : mockSuggestions.join(', ');
                            }
                        }, 1000);
                    } catch (error) {
                        console.error('Failed to get AI suggestions:', error);
                        alert('Failed to get AI suggestions. Please try again later.');
                    }
                };

                // Helper functions
                const formatSourceName = (source) => {
                    const names = {
                        sam: 'SAM.gov',
                        usaspending: 'USAspending',
                        scc: 'System for Award Management (SAM)',
                        dnb: 'Dun & Bradstreet'
                    };
                    return names[source] || source;
                };

                const getStatusMessage = (source, status) => {
                    const messages = {
                        not_started: 'Not enriched yet',
                        pending: 'Enriching data...',
                        complete: 'Data successfully enriched',
                        error: 'Failed to enrich data'
                    };
                    return messages[status] || status;
                };

                // Load profile when component mounts
                onMounted(() => {
                    loadProfile();
                });

                return {
                    loading,
                    profile,
                    enrichmentStatus,
                    saveProfile,
                    enrichFromDuns,
                    enrichFromSource,
                    suggestCapabilities,
                    formatSourceName,
                    getStatusMessage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>