# AccelProcure Codebase Audit

_Last updated: 2025-11-18 15:00:42Z_

## Environment & Tooling Readiness
- `.env.example` already enumerates all client and server credentials (Mapbox, Supabase, Firebase, OpenAI, Stripe, etc.) with notes about what must stay server-side, so new engineers immediately know which secrets to populate before starting either Vite or the Express API.【F:.env.example†L1-L50】
- `package.json`, `vite.config.js`, and `eslint.config.js` codify the expected workflow: the dev server, build, lint, Prettier, and Jest scripts are in place; React + Mapbox + Deck.gl dependencies are installed; Vite path aliases and ESLint configs target both browser and Node code so the monorepo builds consistently.【F:package.json†L1-L65】【F:vite.config.js†L1-L50】【F:eslint.config.js†L1-L118】
- `src/config/app.config.js` and `src/config/mapbox.config.js` read from Vite/Node envs, expose feature flags, credit costs, and set Mapbox defaults, giving both the client and server deterministic configuration objects.【F:src/config/app.config.js†L1-L77】【F:src/config/mapbox.config.js†L1-L96】
- `docs/README.md` already documents how to install dependencies and run the Jest smoke suite (including offline tips), which is enough for onboarding while the remaining guides are written.【F:docs/README.md†L1-L35】

## Backend / API Readiness
- `src/api/index.js` wires Express with JSON parsing, request IDs, global rate limiting, and routers for auth, profiles, RFx, AI helpers, and map layers, exposing `/api/health` for smoke checks.【F:src/api/index.js†L1-L46】
- Auth endpoints (`src/api/routes/authRoutes.js`) enforce schema validation and per-route throttles, delegating to Supabase/Firebase helpers in `src/api/auth/*.js` and the shared `requireAuth` middleware handles both providers.【F:src/api/routes/authRoutes.js†L1-L66】【F:src/api/middleware/authGuard.js†L1-L103】
- RFx routes cover CRUD + evaluation/matching flows with declarative validation, while the AI router provides proposal drafting, response Q&A, vendor matches, and live map insight endpoints with rate limiting.【F:src/api/routes/rfxRoutes.js†L1-L78】【F:src/api/routes/aiRoutes.js†L1-L55】
- The map router currently secures read/write terrain/layer operations and the AI insights controller composes Supabase telemetry, Deck.gl overlays, and optional OpenAI summaries for `/ai/map-insights` + `/metrics`.【F:src/api/routes/mapRoutes.js†L1-L19】【F:src/api/ai/mapInsights.js†L1-L175】
- Utility layers (`src/api/middleware/validateRequest.js`, `src/api/utils/supabaseClient.js`, `src/api/utils/openaiClient.js`) centralize schema validation and third-party clients, which keeps handlers thin and testable.【F:src/api/middleware/validateRequest.js†L1-L125】【F:src/api/utils/supabaseClient.js†L1-L34】【F:src/api/utils/openaiClient.js†L1-L20】

## Frontend & Client Logic Readiness
- `public/app.html` delivers the authenticated shell (navigation drawer, metric cards, 3D map panel, filters), and `public/login.html` wires the sign-in form straight to `authService` for protected flows.【F:public/app.html†L1-L138】【F:public/login.html†L1-L110】
- `src/scripts/app.js` bootstraps auth state, navigation, network handlers, and invokes `initMap`, while `src/scripts/map3d.js` + `src/scripts/map-ai.js` render Mapbox terrain and Deck.gl overlays, metrics side panels, and live AI annotations.【F:src/scripts/app.js†L1-L139】【F:src/scripts/map3d.js†L1-L174】【F:src/scripts/map-ai.js†L1-L200】
- The admin dashboard controller (`src/scripts/admin.js`) loads analytics, responses, and AI insight summaries, and the analytics service bridges Supabase RPCs, cached map insights, and realtime subscriptions for both admin and map panels.【F:src/scripts/admin.js†L1-L200】【F:src/services/analyticsService.js†L1-L155】
- Shared services (`src/services/httpClient.js`, `authService.js`, `mapService.js`, `rfxService.js`, etc.) centralize fetch logic, auth token persistence, and API helpers so UI scripts can stay declarative.【F:src/services/httpClient.js†L1-L191】【F:src/services/authService.js†L1-L152】【F:src/services/mapService.js†L1-L24】【F:src/services/rfxService.js†L1-L61】

## Testing & QA Enablement
- Jest is configured through `jest.config.js`/`src/setupTests.js` (see `package.json` scripts). The current automated coverage is limited to the service smoke suite in `src/services/__tests__/services.test.js` and utility coverage in `src/__tests__/utils/shared.test.js`, which only verify that client services hit the expected endpoints and shared helpers behave, leaving API handlers and UI integrations untested.【F:src/services/__tests__/services.test.js†L1-L74】【F:src/__tests__/utils/shared.test.js†L1-L149】

## Data & Documentation Gaps
- The knowledge-base markdown files (`docs/AI_INTEGRATION.md`, `API_REFERENCE.md`, `AUTH_SYSTEM.md`, `DATA_ENRICHMENT.md`, `DEPLOYMENT.md`, `MAPBOX_3D_SETUP.md`, `SHEET_STRUCTURE.md`) are still empty placeholders; only the README, audit, and map insight guide have content.【81aa75†L1-L11】
- JSON schemas for profiles, RFx, responses, and the credit ledger exist as empty files, so downstream teams still lack canonical contracts beyond the inline validation rules in the routers.【8c7953†L1-L6】
- Mock data for map insights is partially populated, but `data/mock/demoProfiles.json` and `data/mock/demoRfx.json` are 0-byte files, which prevents onboarding/dev tests from replaying realistic dataset permutations.【656225†L1-L4】
- The Google Workspace automation folder (`backend/Code.gs`, `backend/sheetSchema.gs`) remains empty, so the documented spreadsheet workflows in `Development Order.txt` still have no implementation.【bbad01†L1-L4】

## Remaining Tasks & Risks
1. **Align client services with actual API routes.** `aiService` posts to `/ai/proposals`/`/responses`, `mapService` expects `/map/layers`, `profileService` calls `/:profileId/enrich`, and `rfxService` posts to `/:rfxId/responses`, while the Express routers expose `/ai/proposal`, `/ai/response`, `/map` (root), `/profiles/enrich`, and `/:rfxId/respond`. These mismatches will 404 once the UI runs against the API and should be reconciled on both sides.【F:src/services/aiService.js†L1-L38】【F:src/services/mapService.js†L3-L24】【F:src/services/profileService.js†L3-L20】【F:src/services/rfxService.js†L3-L61】【F:src/api/routes/aiRoutes.js†L13-L55】【F:src/api/routes/mapRoutes.js†L10-L17】【F:src/api/routes/profileRoutes.js†L10-L35】【F:src/api/routes/rfxRoutes.js†L13-L53】
2. **Expose the storage, credits, and admin APIs described in the services layer.** The client already calls `/storage/*`, `/credits/*`, and `/admin/responses`, but `src/api/index.js` never mounts matching routers (only auth, profiles, RFx, AI, map). Either add those routers or remove the dead services to prevent runtime errors.【F:src/api/index.js†L35-L45】【F:src/services/storageService.js†L1-L43】【F:src/services/creditService.js†L1-L39】【F:src/scripts/admin.js†L128-L152】
3. **Populate the documentation placeholders promised in `Development Order.txt` (Phases 1–7).** Engineers still lack written guidance on AI integration, API references, auth flows, deployment, map setup, and spreadsheet schemas, all of which were enumerated in the project plan but remain blank markdown files.【F:Development Order.txt†L1-L130】【81aa75†L1-L11】
4. **Define JSON schemas and seed fixtures.** Fill out `data/schema/*.json` (profiles, RFx, responses, credit ledger) and seed `data/mock/demoProfiles.json`/`demoRfx.json` so Supabase tables, Postman collections, and Jest/e2e tests can share canonical payloads.【8c7953†L1-L6】【656225†L1-L4】
5. **Restore Google Workspace / Sheets automation.** Populate `backend/Code.gs` and `backend/sheetSchema.gs` or remove the folder; today they are empty stubs even though administrators expect Sheets exports and Apps Script sync jobs per the documentation set.【bbad01†L1-L4】
6. **Broaden automated testing.** Add API contract tests (e.g., supertest against `src/api/index.js`), UI smoke tests for the Vite bundle, and regression coverage for the AI/map overlay flows. Right now only service routing and a few shared helpers are verified via Jest, which won’t catch API regressions or frontend-map integration issues.【F:src/services/__tests__/services.test.js†L1-L74】【F:src/__tests__/utils/shared.test.js†L1-L149】
7. **Close the loop on credits & analytics flows.** The plan calls for credit debits (`Development Order` Phase 3) and AI analytics (Phase 7), but without server endpoints or schema docs the balance/ledger UI can’t function, and the admin dashboard can’t reconcile Supabase RPC responses with defined contracts. Prioritize standing up those APIs/schemas before exposing the UI to users.【F:Development Order.txt†L48-L130】【F:src/services/creditService.js†L1-L39】【F:src/scripts/admin.js†L89-L200】
